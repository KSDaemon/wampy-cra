{"version":3,"file":"wampy-cra.js","names":["define","m","exports","module","WampyCra","isNode","process","Object","prototype","toString","call","crypto","require","deriveKey","secret","salt","iterations","keylen","key","pbkdf2Sync","config","keySize","hasher","algo","SHA256","PBKDF2","enc","Base64","signManual","challenge","hmac","createHmac","update","digest","HmacSHA256","sign","method","info","Error"],"sources":["../src/wampy-cra.js"],"sourcesContent":["/**\n * Project: wampy-cra.js\n *\n * https://github.com/KSDaemon/wampy-cra\n *\n * Wampy.js Challenge Response Authentication plugin\n *\n * Copyright 2016 KSDaemon. Licensed under the MIT License.\n * See @license text at http://www.opensource.org/licenses/mit-license.php\n *\n */\n\n// Module boilerplate to support browser globals and browserify and AMD.\n(\n    typeof define === 'function' ? function (m) {\n        define('WampyCra', m);\n    } :\n        typeof exports === 'object' ? function (m) {\n            module.exports = m();\n        } :\n            function (m) {\n                this.WampyCra = m();\n            }\n)(function () {\n\n    const WampyCra = {},\n        isNode = (typeof process === 'object' && Object.prototype.toString.call(process) === '[object process]'),\n        crypto = isNode ? require('crypto') : require('crypto-js');\n\n    function deriveKey (secret, salt, iterations = 1000, keylen = 32) {\n        let key;\n\n        if (isNode) {\n            key = crypto.pbkdf2Sync(secret, salt, iterations, keylen, 'sha256');\n            return key.toString('base64');\n        } else {\n            let config = {\n                keySize   : keylen / 4,\n                iterations: iterations,\n                hasher    : crypto.algo.SHA256\n            };\n\n            key = crypto.PBKDF2(secret, salt, config);\n            return key.toString(crypto.enc.Base64);\n        }\n    }\n\n    function signManual (key, challenge) {\n        if (isNode) {\n            let hmac = crypto.createHmac('sha256', key);\n            hmac.update(challenge);\n            return hmac.digest('base64');\n        } else {\n            return crypto.HmacSHA256(challenge, key).toString(crypto.enc.Base64);\n        }\n    }\n\n    function sign (secret) {\n\n        return function (method, info) {\n            if (method === 'wampcra') {\n\n                if (info.salt) {\n                    return signManual(deriveKey(secret, info.salt, info.iterations, info.keylen), info.challenge);\n                } else {\n                    return signManual(secret, info.challenge);\n                }\n\n            } else {\n                throw new Error('Unknown authentication method requested!');\n            }\n        };\n    }\n\n    WampyCra.deriveKey = deriveKey;\n    WampyCra.signManual = signManual;\n    WampyCra.sign = sign;\n\n    return WampyCra;\n\n});\n"],"mappings":"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"}